<!-- CSS -->
<style>
  .form-control,
  .form-control:focus,
  .form-control-file {
    background-color: #ffffff;
    color: #333; /* Dark text color to improve readability */
    border: 1px solid #444;
    padding: 3px 6px !important;
    font-size: 0.85rem;
  }

  .form-control::placeholder {
    color: #bbb;
  }

  textarea.form-control {
    background-color: #ffffff;
    color: #333; /* Dark text color for textarea */
    border: 1px solid #444;
  }

  /* Container adjustments */
  .container {
    max-width: 500px; /* Set the width of the form container */
  }

  /* Adjust the profile image size */
  .profile-img {
    width: 120px; /* Reduced width */
    height: 120px; /* Reduced height */
  }

  /* Adjust spacing around form elements */
  .mb-3 {
    margin-bottom: 1rem; /* Reduce the bottom margin between form elements */
  }

  /* Reduce the padding inside the card */
  .card-body {
    padding: 1.5rem;
  }

  /* Reduce button padding */
  .btn {
    padding: 0.5rem 1rem; /* Adjust button padding */
  }
</style>

<!-- Load Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<div class="container mt-4">
  <div class="card text-dark">
    <div class="card-header border-bottom border-secondary">
      <h5>Edit Profile</h5>
    </div>
    <div class="card-body">
      <!-- Form Fields without <form> tag -->
      <div class="mb-3 text-center">
        <label>Profile Picture</label>
        <!--<img src="../assets/img/apple-icon.png" alt="Profile Picture" class="rounded-circle mb-3 profile-img">-->
        <input type="file" class="form-control-file" id="profilePic" accept=".jpg, .jpeg, .png">
        <small id="fileHelp" class="form-text text-muted"></small>
  <!--<br>
  <button type="submit">Upload</button>-->

<script>
  const fileInput = document.getElementById('profilePic');
  const helpText = document.getElementById('fileHelp');

  let finalFile = null;

  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;

    if (!file.type.startsWith('image/')) {
      helpText.textContent = "❌ Please upload an image file.";
      return;
    }

    const maxSizeMB = 2;
    const maxSizeBytes = maxSizeMB * 1024 * 1024;

    if (file.size > maxSizeBytes) {
      // Compress image
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');

          const scaleFactor = Math.sqrt(maxSizeBytes / file.size); // adjust size
          canvas.width = img.width * scaleFactor;
          canvas.height = img.height * scaleFactor;

          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          canvas.toBlob(function (blob) {
            finalFile = new File([blob], file.name, { type: file.type });
            helpText.textContent = `✅ Image compressed to ${(finalFile.size / 1024 / 1024).toFixed(2)} MB`;
          }, file.type, 0.8); // 0.8 = quality (80%)
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    } else {
      finalFile = file;
      helpText.textContent = "✅ File is under 2MB, no compression needed.";
    }
  });

  document.getElementById('uploadForm').addEventListener('submit', function (e) {
    e.preventDefault();

    if (!finalFile) {
      alert("Please select a valid image.");
      return;
    }

    // Upload using FormData (as example)
    const formData = new FormData();
    formData.append('file', finalFile);

    // Simulate upload
    console.log("Uploading:", finalFile);
    alert("✅ File ready to upload! (check console)");

    // You could now use fetch() or AJAX to send `formData` to your backend
  });
</script>
      

      </div>

      <div class="mb-3">
        <label class="form-label">Full Name</label>
        <input type="text" class="form-control" id="full_name" placeholder="Enter your full name">
      </div>

      <div class="mb-3">
        <label class="form-label">Email Address</label>
        <input type="email" class="form-control" id="email" placeholder="Enter your email">
      </div>

      <div class="mb-3">
        <label class="form-label">Company Name</label>
        <input type="text" class="form-control" id="company" placeholder="Company name">
      </div>

      <div class="mb-3">
        <label class="form-label">Company ID</label>
        <input type="text" class="form-control" id="companyid" placeholder="Company ID">
      </div>

      <div class="mb-3">
        <label class="form-label">Username</label>
        <input type="text" class="form-control" id="username" placeholder="Choose a username">
      </div>

      <div class="mb-3">
        <label class="form-label">Password</label>
        <input type="password" class="form-control" id="password" placeholder="Create a password">
      </div>

      <div class="mb-3">
        <label class="form-label">Short Bio</label>
        <textarea class="form-control" id="bio" rows="2" placeholder="Tell us a little about yourself..."></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Role</label>
        <select class="form-select" id="role">
          <option value="agent" selected>Agent</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <div class="text-end">
        <button id="saveUserBtn" class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabase = createClient(
    'https://bmroymhdqqbzlubpfjvs.supabase.co',  // Replace with your Supabase URL
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJtcm95bWhkcXFiemx1YnBmanZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NTc4MjMsImV4cCI6MjA2MTAzMzgyM30.k-Vcbza0LeYr9mtQXwD2gHkIys-kmU0uky6VJ0LMX3g'                 // Replace with your anon key
  );

  document.getElementById('saveUserBtn').addEventListener('click', async () => {
    const user = {
      profilePIc:document.getElementbyId('profilePic').value,
      full_name: document.getElementById('full_name').value,
      email: document.getElementById('email').value,
      company: document.getElementById('company').value,
      username: document.getElementById('username').value,
      password: document.getElementById('password').value,
      bio: document.getElementById('bio').value,
      role: document.getElementById('role').value,
      is_active: true,
      created_at: new Date().toISOString()
    };
console.log(user);
    const { data, error } = await supabase.from('user').insert([user]);

    if (error) {
      alert('❌ Error: ' + error.message);
      console.error(error);
    } else {
      alert('✅ User created successfully!');
      // Clear fields
      document.querySelectorAll('input, textarea').forEach(el => el.value = '');
      document.getElementById('role').value = 'agent';
    }
  });
</script>
